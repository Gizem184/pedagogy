{% extends "base.html" %}

{% block content %}
    <script src=" {{ url_for('static', filename='js/vega.min.js') }} "></script>
    <script src=" {{ url_for('static', filename='js/vega-lite.js') }} "></script>
    <script src=" {{ url_for('static', filename='js/vega-embed.min.js') }} "></script>

    <p>You're looking at performance metrics for: 
        {{ employee.email }}, joined on {{ employee.join_date }}</p>

    <div class="plot" id="vis_accomp_1"></div>

    <h2>Students</h2>
    <h4>Total Number of Students:</h4>    
    {{ totalstud }}
    
    <h4>Total Number of Hours:</h4>    
    {{ totalhours }}
    <hr>

    <div class="plot" id="vis_accomp_2"></div>
    

    <h4>Category Breakdown</h4>
    {% for gr in grped %}
        {{ gr }}: {{ grped[gr]['count'] }} | {{ (grped[gr]['students']) }} students. <br>
    {% endfor %}
    
    <hr>

    <h2>Workshop Timeline</h2>
    {% for workshop in workshops %}
        <div>
            {{ workshop.workshop_start }}<br>    
            {{ workshop.workshop_name }}: <b> {{ workshop.workshop_category }}</b> <br/>
            <small> {{ workshop.workshop_venue }} | {{ workshop.class_size }} students | {{ workshop.workshop_hours }} hours </small>
        </div>
        <br>
    {% endfor %}

    <hr>

    <h2>Notable Comments</h2>
    {% for response in responses %}
            {{ response.satisfaction_score }} | {{ response.comments }}<br/>
    {% endfor %}
    
    <hr>
    <script type="text/javascript">
        function parse(url, div) {
            var opt = {
              mode: "vega-lite",
              renderer: "svg",
              actions: {export: true, source: false, editor: false}
            }; 
        //var spec = "https://raw.githubusercontent.com/vega/vega/master/docs/examples/bar-chart.vg.json";
    
            vegaEmbed(div, url, opt).then(function(result) {
              // Access the Vega view instance (https://vega.github.io/vega/docs/api/view/) as result.view
            }).catch(console.error);
        }
        parse("/data/class_size_vs", "#vis_accomp_1")
        parse("/data/class_size_hours", "#vis_accomp_2")
    </script>

{% endblock %}
